name: Update Submodules

on:
  workflow_dispatch:

jobs:
  update-submodules:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2
      with:
        submodules: 'recursive'

    - name: Update mlflow submodule
      run: |
        mlflow_commit=$(curl -s "https://api.github.com/repos/m-team-kit/mlflow-auth-gui/commits/main" | jq -r '.sha')
        echo "MLflow submodule latest commit: $mlflow_commit"
        git submodule update --remote mlflow-auth-gui
        cd mlflow-auth-gui
        git checkout $mlflow_commit
        cd ..

    - name: Update frouros submodule
      run: |
        frouros_commit=$(curl -s "https://api.github.com/repos/IFCA-Advanced-Computing/frouros/commits/main" | jq -r '.sha')
        echo "Frouros submodule latest commit: $frouros_commit"
        git submodule update --remote frouros
        cd frouros
        git checkout $frouros_commit
        cd ..

    - name: Commit and Push Changes
      run: |
        git config --global user.email "actions@github.com"
        git config --global user.name "GitHub Actions"
        git add .
        git commit -m "Update submodule commits"
        git push
